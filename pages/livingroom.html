<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/logo-2.png">
    <link rel="icon" type="image/png" href="../assets/img/logo-2.png">
    <title>
        Soft UI Dashboard by Creative Tim
    </title>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link id="pagestyle" href="../assets/css/soft-ui-dashboard.css?v=1.0.3" rel="stylesheet" />
    <!-- Scroll Bar -->
    <!-- <link href="../assets/css/customScrollbar.css" rel="stylesheet" /> -->
    <link href="../assets/css/noScroll.css" rel="stylesheet" />
    <!-- toastr -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.css" rel="stylesheet" />
    <link href="../assets/css/custom-toastr.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
    <!-- silder button -->
    <link href="../assets/css/toggle_button.css" rel="stylesheet" />
</head>

<body class="g-sidenav-show  bg-gray-100">
    <aside
        class="myDiv noscroll sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-light"
        id="sidenav-main">
        <div class="sidenav-header ms-3">
            <a class="navbar-brand m-0" href="../pages/dashboard.html">
                <img src="../image/homeiot.png" class="img-fluid" alt="main_logo">
                <span class="ms-1 font-weight-bold">My Dashboard</span>
            </a>
        </div>
        <hr class="horizontal dark mt-0">
        <div class="collapse navbar-collapse  noscroll  max-height-vh-100 h-100" id="sidenav-collapse-main">
            <ul class="navbar-nav">
                <li class="nav-item zoom">
                    <a class="nav-link" href="../pages/dashboard.html">
                        <div
                            class="icon icon-shape text-center shadow border-radius-md me-2 d-flex align-items-center justify-content-center">
                            <img src="../image/dashboard.png" class="img-fluid">
                        </div>
                        <span class="nav-link-text ms-1 font-weight-bold text-dark">Overview</span>
                    </a>
                </li>
                <li class="nav-item zoom">
                    <a class="nav-link active" href="../pages/livingroom.html">
                        <div
                            class="icon icon-shape text-center shadow border-radius-md me-2 d-flex align-items-center justify-content-center">
                            <img src="../image/sofa.png" class="img-fluid">
                        </div>
                        <span class="nav-link-text ms-1 font-weight-bold text-dark">Living Room</span>
                    </a>
                </li>
                <li class="nav-item zoom">
                    <a class="nav-link  " href="../pages/kitchen.html">
                        <div
                            class="icon icon-shape text-center shadow border-radius-md me-2 d-flex align-items-center justify-content-center">
                            <img src="../image/kitchen.png" class="img-fluid">
                        </div>
                        <span class="nav-link-text ms-1 font-weight-bold text-dark">Kitchen</span>
                    </a>
                </li>
                <li class="nav-item zoom">
                    <a class="nav-link  " href="../pages/bed1.html">
                        <div
                            class="icon icon-shape text-center shadow border-radius-md me-2 d-flex align-items-center justify-content-center">
                            <img src="../image/bedroom1.png" class="img-fluid">
                        </div>
                        <span class="nav-link-text ms-1 font-weight-bold text-dark">Bedroom 1</span>
                    </a>
                </li>
                <li class="nav-item zoom">
                    <a class="nav-link  " href="../pages/bed2.html">
                        <div
                            class="icon icon-shape text-center shadow border-radius-md me-2 d-flex align-items-center justify-content-center">
                            <img src="../image/bedroom2.png" class="img-fluid">
                        </div>
                        <span class="nnav-link-text ms-1 font-weight-bold text-dark">Bedroom 2</span>
                    </a>
                </li>
                <li class="nav-item mt-3">
                    <h6 class="ps-4 ms-2 text-uppercase text-xs font-weight-bolder text-dark">Account pages</h6>
                </li>
                <li class="nav-item zoom">
                    <a class="nav-link" href="/log-out">
                        <div
                            class="icon icon-shape text-center shadow border-radius-md me-2 d-flex align-items-center justify-content-center">
                            <img src="../image/logout.png" class="img-fluid">
                        </div>
                        <span class="nav-link-text ms-1 font-weight-bolder text-dark">Log Out</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside>
    <main class="main-content position-relative max-height-vh-100 h-100 mt-1 border-radius-lg ">
        <!-- Navbar -->
        <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-none border-radius-xl" id="navbarBlur"
            navbar-scroll="true">
            <div class="container-fluid py-1 px-3">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb bg-transparent mb-0 pb-0 pt-1 px-0 me-sm-6 me-5">
                        <li class="breadcrumb-item text-sm"><a class="opacity-5 text-dark" href="javascript:;">Pages</a>
                        </li>
                        <li class="breadcrumb-item text-sm text-dark active" aria-current="page">Overview</li>
                    </ol>
                    <h6 class="font-weight-bolder mb-0">Overview </h6>
                </nav>
                <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
                    <div class="ms-md-auto pe-md-3 d-flex align-items-center">
                        <a class="nav-link text-body font-weight-bold px-0">
                            <i class="bi bi-clock-fill"></i>
                            <span class="d-sm-inline d-none ps-1 pe-1">Local Time:</span>
                            <span class="d-sm-inline d-none" id="local-time"></span>
                        </a>
                    </div>
                    <ul class="navbar-nav  justify-content-end">
                        <li class="nav-item d-xl-none ps-3 d-flex align-items-center">
                            <a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
                                <div class="sidenav-toggler-inner">
                                    <i class="sidenav-toggler-line"></i>
                                    <i class="sidenav-toggler-line"></i>
                                    <i class="sidenav-toggler-line"></i>
                                </div>
                            </a>
                        </li>
                        <li class="nav-item dropdown pe-2 ps-3 d-flex align-items-center">
                            <a href="javascript:;" class="nav-link text-body p-0 font-weight-bold"
                                data-bs-toggle="dropdown" id="dropdownSettingBtn">
                                <i class="fa fa-cog fixed-plugin-button-nav cursor-pointer"></i>
                                <span class="d-sm-inline d-nonep ps-1">Cài Đặt</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end px-2 py-2 me-sm-n4 border border-primary"
                                aria-labelledby="dropdownMenuButton">
                                <li class="mb-2 mt-2 font-weight-bold text-center">Đặt ngưỡng</li>
                                <li class="dropdown-item border-radius-md">
                                    <form id="dropdownSettingMenu">
                                        <h6 class="text-sm font-weight-bold">Nhiệt độ</h6>
                                        <input class="form-control form-control-sm mb-2" type="number"
                                            onfocus="this.value=''" placeholder="đặt ngưỡng" id="max-temper">
                                        <h6 class="text-sm font-weight-bold">Độ ẩm</h6>
                                        <input class="form-control form-control-sm mb-2" type="number"
                                            onfocus="this.value=''" placeholder="đặt ngưỡng" id="max-humi">
                                        <h6 class="text-sm font-weight-bold">Co2</h6>
                                        <input class="form-control form-control-sm mb-2" type="number"
                                            onfocus="this.value=''" placeholder="đặt ngưỡng" id="max-co2">
                                        <h6 class="text-sm font-weight-bold">Gas</h6>
                                        <input class="form-control form-control-sm mb-2" type="number"
                                            onfocus="this.value=''" placeholder="đặt ngưỡng" id="max-gas">
                                        <h6 class="text-sm font-weight-bold">Dust</h6>
                                        <input class="form-control form-control-sm mb-2" type="number"
                                            onfocus="this.value=''" placeholder="đặt ngưỡng" id="max-dust">
                                        <button type="button" class="btn btn-sm bg-gradient-success mt-2 ms-2"
                                            id="setting_btn">Accept</button>
                                    </form>
                                </li>
                            </ul>
                        </li>

                        <li class="nav-item dropdown pe-2 ps-3 d-flex align-items-center">
                            <a href="javascript:;" class="nav-link text-body p-0 font-weight-bold"
                                id="dropdownNotifiButton" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa fa-bell cursor-pointer"></i>
                                <span class="d-sm-inline d-none ps-1">Thông Báo</span>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end px-2 py-2 me-sm-n4 border border-primary"
                                aria-labelledby="dropdownMenuButton">
                                <li class="mb-2 mt-2 font-weight-bold text-center">Lịch sử quá ngưỡng</li>
                                <li class="mb-2">
                                    <a class="dropdown-item border-radius-md" href="javascript:;">
                                        <div class="d-flex py-1">
                                            <div class="my-auto">
                                                <img src="../image/temperature.png" class="avatar avatar-sm  me-3 ">
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="text-sm font-weight-normal mb-1">
                                                    <span class="font-weight-bold pe-2">Nhiệt độ: </span>
                                                    <span id="temper_history"></span>
                                                </h6>
                                                <p class="text-xs text-secondary mb-0">
                                                    <i class="fa fa-clock me-1"></i>
                                                    <span id="temper_history_time"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a class="dropdown-item border-radius-md" href="javascript:;">
                                        <div class="d-flex py-1">
                                            <div class="my-auto">
                                                <img src="../image/humidity.png" class="avatar avatar-sm  me-3 ">
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="text-sm font-weight-normal mb-1">
                                                    <span class="font-weight-bold pe-2">Độ ẩm: </span>
                                                    <span id="humi_history"></span>
                                                </h6>
                                                <p class="text-xs text-secondary mb-0">
                                                    <i class="fa fa-clock me-1"></i>
                                                    <span id="humi_history_time"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a class="dropdown-item border-radius-md" href="javascript:;">
                                        <div class="d-flex py-1">
                                            <div class="my-auto">
                                                <img src="../image/co2.png" class="avatar avatar-sm  me-3 ">
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="text-sm font-weight-normal mb-1">
                                                    <span class="font-weight-bold pe-2">Co2: </span>
                                                    <span id="co2_history"></span>
                                                </h6>
                                                <p class="text-xs text-secondary mb-0">
                                                    <i class="fa fa-clock me-1"></i>
                                                    <span id="co2_history_time"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a class="dropdown-item border-radius-md" href="javascript:;">
                                        <div class="d-flex py-1">
                                            <div class="my-auto">
                                                <img src="../image/gas.png" class="avatar avatar-sm  me-3 ">
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="text-sm font-weight-normal mb-1">
                                                    <span class="font-weight-bold pe-2">Gas: </span>
                                                    <span id="gas_history"></span>
                                                </h6>
                                                <p class="text-xs text-secondary mb-0">
                                                    <i class="fa fa-clock me-1"></i>
                                                    <span id="gas_history_time"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                                <li class="mb-2">
                                    <a class="dropdown-item border-radius-md" href="javascript:;">
                                        <div class="d-flex py-1">
                                            <div class="my-auto">
                                                <img src="../image/dust.png" class="avatar avatar-sm  me-3 ">
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="text-sm font-weight-normal mb-1">
                                                    <span class="font-weight-bold pe-2">Dust: </span>
                                                    <span id="dust_history"></span>
                                                </h6>
                                                <p class="text-xs text-secondary mb-0">
                                                    <i class="fa fa-clock me-1"></i>
                                                    <span id="dust_history_time"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </a>
                                </li>

                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- End Navbar -->
        <div class="container-fluid py-4">
            <div class="row mt-3">
                <div class="col-lg mb-3">
                    <div class="card h-100 border border-primary px-3">
                        <div class="col-lg-12 text-center" style="height: 370px;">
                            <img src="../image/no-signal.png" class="img-fluid mt-4" id="showCamera"
                                style="max-height: 370px;">
                        </div>
                        <div class="col-lg-12 mt-3 mb-3 px-4">
                            <h5 class="card-title text-center">Camera IP</h5>
                            <form onsubmit="return false;" class="input-group" id="camera_input">
                                <input class="form-control text-center" name="urlCamera" placeholder="Nhập IP Camera"
                                    type="text" required>
                                <button class="btn bg-gradient-info mb-0" type="submit" name="submitBtn">Accept</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="col-lg mb-3">
                    <div class="card py-2 px-2 border border-primary">
                        <h5 class="card-title text-center mt-2">Điều Khiển</h5>
                        <div class="card-group mt-2 mb-3">
                            <div class="card zoom bg-light mx-2 cursor-pointer rounded-3 d-flex align-items-center"
                                id="device1_btn">
                                <h6 class="font-weight-bolder text-center pt-3">Device 1</h6>
                                <label class="switch">
                                    <input type="checkbox" id="device1_check">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="card zoom bg-light mx-2 cursor-pointer rounded-3 d-flex align-items-center"
                                id="device2_btn">
                                <h6 class="font-weight-bolder text-center pt-3">Device 2</h6>
                                <label class="switch">
                                    <input type="checkbox" id="device2_check">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="card zoom bg-light mx-2 cursor-pointer rounded-3 d-flex align-items-center"
                                id="device3_btn">
                                <h6 class="font-weight-bolder text-center pt-3">Device 3</h6>
                                <label class="switch">
                                    <input type="checkbox" id="device3_check">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                            <div class="card zoom bg-light mx-2 cursor-pointer rounded-3 d-flex align-items-center"
                                id="device4_btn">
                                <h6 class="font-weight-bolder text-center pt-3">Device 4</h6>
                                <label class="switch">
                                    <input type="checkbox" id="device4_check">
                                    <span class="slider round"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-3 py-2 px-3 border border-primary">
                        <h5 class="card-title text-center mt-2">Hẹn Giờ</h5>
                        <form onsubmit="return false;" class="input-group my-2" id="device1_timer">
                            <!-- <div class="input-group my-2" id="device1_timer"> -->
                            <input type="checkbox" disabled class="align-self-center me-2" name="check">
                            <input class="form-control border-start border-end text-center" name="dateStart"
                                placeholder="Hẹn ngày bật" type="text" onfocus="(this.type='date')"
                                onblur="(this.type='text')" required>
                            <input class="form-control border-start text-center" name="timeStart"
                                placeholder="Hẹn giờ bật" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')" required>
                            <button class="btn bg-gradient-primary mb-0" type="submit" name="submitBtn">Device
                                1</button>
                            <input class="form-control border-end text-center" name="timeOff"
                                placeholder="(option) Giờ tắt" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')">
                            <button type="button" class="btn-close btn-sm align-self-center ms-2 rounded-2 bg-danger"
                                aria-label="Close" name="closeBtn"></button>
                            <!-- </div> -->
                        </form>

                        <form onsubmit="return false;" class="input-group my-2" id="device2_timer">
                            <!-- <div class="input-group my-2" id="device1_timer"> -->
                            <input type="checkbox" disabled class="align-self-center me-2" name="check">
                            <input class="form-control border-start border-end text-center" name="dateStart"
                                placeholder="Hẹn ngày bật" type="text" onfocus="(this.type='date')"
                                onblur="(this.type='text')" required>
                            <input class="form-control border-start text-center" name="timeStart"
                                placeholder="Hẹn giờ bật" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')" required>
                            <button class="btn bg-gradient-primary mb-0" type="submit" name="submitBtn">Device
                                2</button>
                            <input class="form-control border-end text-center" name="timeOff"
                                placeholder="(option) Giờ tắt" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')">
                            <button type="button" class="btn-close btn-sm align-self-center ms-2 rounded-2 bg-danger"
                                aria-label="Close" name="closeBtn"></button>
                            <!-- </div> -->
                        </form>

                        <form onsubmit="return false;" class="input-group my-2" id="device3_timer">
                            <!-- <div class="input-group my-2" id="device1_timer"> -->
                            <input type="checkbox" disabled class="align-self-center me-2" name="check">
                            <input class="form-control border-start border-end text-center" name="dateStart"
                                placeholder="Hẹn ngày bật" type="text" onfocus="(this.type='date')"
                                onblur="(this.type='text')" required>
                            <input class="form-control border-start text-center" name="timeStart"
                                placeholder="Hẹn giờ bật" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')" required>
                            <button class="btn bg-gradient-primary mb-0" type="submit" name="submitBtn">Device
                                3</button>
                            <input class="form-control border-end text-center" name="timeOff"
                                placeholder="(option) Giờ tắt" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')">
                            <button type="button" class="btn-close btn-sm align-self-center ms-2 rounded-2 bg-danger"
                                aria-label="Close" name="closeBtn"></button>
                            <!-- </div> -->
                        </form>

                        <form onsubmit="return false;" class="input-group my-2" id="device4_timer">
                            <!-- <div class="input-group my-2" id="device1_timer"> -->
                            <input type="checkbox" disabled class="align-self-center me-2" name="check">
                            <input class="form-control border-start border-end text-center" name="dateStart"
                                placeholder="Hẹn ngày bật" type="text" onfocus="(this.type='date')"
                                onblur="(this.type='text')" required>
                            <input class="form-control border-start text-center" name="timeStart"
                                placeholder="Hẹn giờ bật" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')" required>
                            <button class="btn bg-gradient-primary mb-0" type="submit" name="submitBtn">Device
                                4</button>
                            <input class="form-control border-end text-center" name="timeOff"
                                placeholder="(option) Giờ tắt" type="text" onfocus="(this.type='time')"
                                onblur="(this.type='text')">
                            <button type="button" class="btn-close btn-sm align-self-center ms-2 rounded-2 bg-danger"
                                aria-label="Close" name="closeBtn"></button>
                            <!-- </div> -->
                        </form>
                    </div>
                </div>
            </div>
            <footer class="footer pt-2  ">
                <div class="container-fluid">
                    <div class="row align-items-center justify-content-lg-between">
                        <div class="col-lg-6 mb-lg-0 mb-4">
                            <div class="copyright text-center text-sm text-muted text-lg-start">
                                ©
                                <script>
                                    document.write(new Date().getFullYear())
                                </script>,
                                made with <i class="fa fa-heart"></i> by
                                <a href="https://www.creative-tim.com" class="font-weight-bold" target="_blank">Creative
                                    Tim</a>
                                for a better web.
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <ul class="nav nav-footer justify-content-center justify-content-lg-end">
                                <li class="nav-item">
                                    <a href="https://www.creative-tim.com" class="nav-link text-muted"
                                        target="_blank">Creative Tim</a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://www.creative-tim.com/presentation" class="nav-link text-muted"
                                        target="_blank">About
                                        Us</a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://creative-tim.com/blog" class="nav-link text-muted"
                                        target="_blank">Blog</a>
                                </li>
                                <li class="nav-item">
                                    <a href="https://www.creative-tim.com/license" class="nav-link pe-0 text-muted"
                                        target="_blank">License</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </main>
    <!--   Core JS Files   -->
    <script src="../assets/js/core/popper.min.js"></script>
    <script src="../assets/js/core/bootstrap.min.js"></script>
    <script src="../assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="../assets/js/plugins/smooth-scrollbar.min.js"></script>
    <!-- Github buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="../assets/js/soft-ui-dashboard.min.js?v=1.0.3"></script>
    <!-- Socket IO -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- local time -->
    <script>
        const socket = io();
        setInterval(function () {
            var whatTimeIsThis = new Date()
            whatTimeIsThis = whatTimeIsThis.toString().slice(4, 24);
            document.getElementById("local-time").innerHTML = whatTimeIsThis
        }, 1000)
    </script>

    <!-- 123 -->
    <script>
        /*---------------BUTTON---------------*/
        var device1_button = document.getElementById("device1_btn");
        var device2_button = document.getElementById("device2_btn");
        var device3_button = document.getElementById("device3_btn");
        var device4_button = document.getElementById("device4_btn");
        device1_button.addEventListener("click", function () {
            document.getElementById("device1_check").checked = !document.getElementById("device1_check").checked;
            on_off_button();
        });
        device2_button.addEventListener("click", function () {
            document.getElementById("device2_check").checked = !document.getElementById("device2_check").checked;
            on_off_button();
        });
        device3_button.addEventListener("click", function () {
            document.getElementById("device3_check").checked = !document.getElementById("device3_check").checked;
            on_off_button();
        });
        device4_button.addEventListener("click", function () {
            document.getElementById("device4_check").checked = !document.getElementById("device4_check").checked;
            on_off_button();
        });

        function on_off_button() {
            var list = {
                "Room": "livingroom",
                "Device": [0, 0, 0, 0]
            }
            list.Device[0] = document.getElementById("device1_check").checked | 0;//biswise OR
            list.Device[1] = document.getElementById("device2_check").checked | 0;
            list.Device[2] = document.getElementById("device3_check").checked | 0;
            list.Device[3] = document.getElementById("device4_check").checked | 0;
            // console.log(list);
            socket.emit("device_control", list);
        }

        //cập nhật trạng thái nút nhấn
        socket.on("button_state", function (data) {
            for (let i in data) {
                if (data[i].Room == "livingroom") {
                    document.getElementById("device1_check").checked = !!+data[i].Device1
                    document.getElementById("device2_check").checked = !!+data[i].Device2
                    document.getElementById("device3_check").checked = !!+data[i].Device3
                    document.getElementById("device4_check").checked = !!+data[i].Device4
                }
            }
        });

        /*--------------TIMER-----------------*/
        //The elements collection returns a collection of all elements in a form.
        var device1_timer = document.getElementById("device1_timer").elements;
        var device2_timer = document.getElementById("device2_timer").elements;
        var device3_timer = document.getElementById("device3_timer").elements;
        var device4_timer = document.getElementById("device4_timer").elements;
        //timer device1
        device1_timer.namedItem("submitBtn").addEventListener("click", function () {
            submit_timer(device1_timer, "livingroom", 1);
        });
        device1_timer.namedItem("dateStart").addEventListener("blur", function () {
            timer_date_handle(device1_timer);
        });
        device1_timer.namedItem("timeStart").addEventListener("blur", function () {
            timer_time_handle(device1_timer);
        });
        device1_timer.namedItem("timeOff").addEventListener("blur", function () {
            timer_time_handle(device1_timer);
        });
        device1_timer.namedItem("closeBtn").addEventListener("click", function () {
            delete_timer(device1_timer, "livingroom", 1);
        });
        //timer device2
        device2_timer.namedItem("submitBtn").addEventListener("click", function () {
            submit_timer(device2_timer, "livingroom", 2);
        });
        device2_timer.namedItem("dateStart").addEventListener("blur", function () {
            timer_date_handle(device2_timer);
        });
        device2_timer.namedItem("timeStart").addEventListener("blur", function () {
            timer_time_handle(device2_timer);
        });
        device2_timer.namedItem("timeOff").addEventListener("blur", function () {
            timer_time_handle(device2_timer);
        });
        device2_timer.namedItem("closeBtn").addEventListener("click", function () {
            delete_timer(device2_timer, "livingroom", 2);
        });
        //timer device3
        device3_timer.namedItem("submitBtn").addEventListener("click", function () {
            submit_timer(device3_timer, "livingroom", 3);
        });
        device3_timer.namedItem("dateStart").addEventListener("blur", function () {
            timer_date_handle(device3_timer);
        });
        device3_timer.namedItem("timeStart").addEventListener("blur", function () {
            timer_time_handle(device3_timer);
        });
        device3_timer.namedItem("timeOff").addEventListener("blur", function () {
            timer_time_handle(device3_timer);
        });
        device3_timer.namedItem("closeBtn").addEventListener("click", function () {
            delete_timer(device3_timer, "livingroom", 3);
        });
        //timer device4
        device4_timer.namedItem("submitBtn").addEventListener("click", function () {
            submit_timer(device4_timer, "livingroom", 4);
        });
        device4_timer.namedItem("dateStart").addEventListener("blur", function () {
            timer_date_handle(device4_timer);
        });
        device4_timer.namedItem("timeStart").addEventListener("blur", function () {
            timer_time_handle(device4_timer);
        });
        device4_timer.namedItem("timeOff").addEventListener("blur", function () {
            timer_time_handle(device4_timer);
        });
        device4_timer.namedItem("closeBtn").addEventListener("click", function () {
            delete_timer(device4_timer, "livingroom", 4);
        });

        var date = new Date();
        function timer_date_handle(device_timer) {
            var currentDate = date.getFullYear() + '-' + (date.getMonth() + 1).toString().padStart(2, '0') + '-' + date.getDate().toString().padStart(2, '0');
            var currentTime = date.getHours().toString().padStart(2, '0') + ':' + date.getMinutes().toString().padStart(2, '0');

            //ngày phải lớn hơn hoặc bằng ngày hiện tại
            if (device_timer.namedItem("dateStart").value < currentDate) {
                device_timer.namedItem("dateStart").setCustomValidity("Ngày không hợp lệ");
                device_timer.namedItem("dateStart").reportValidity();
                device_timer.namedItem("dateStart").setCustomValidity('');
                device_timer.namedItem("dateStart").value = "";
            }
            else
                timer_time_handle(device_timer);
        }
        function timer_time_handle(device_timer) {
            var currentDate = date.getFullYear() + '-' + (date.getMonth() + 1).toString().padStart(2, '0') + '-' + date.getDate().toString().padStart(2, '0');
            var currentTime = date.getHours().toString().padStart(2, '0') + ':' + date.getMinutes().toString().padStart(2, '0');

            //nếu cùng ngày thì giờ bật phải > current time
            if (device_timer.namedItem("timeStart").value != "" && device_timer.namedItem("timeStart").value <= currentTime && device_timer.namedItem("dateStart").value == currentDate) {
                device_timer.namedItem("timeStart").setCustomValidity("Giờ bật không hợp lệ");
                device_timer.namedItem("timeStart").reportValidity();
                device_timer.namedItem("timeStart").setCustomValidity('');
                device_timer.namedItem("timeStart").value = "";
            }

            //nếu hẹn giờ tắt thì phải lớn hơn giờ bật
            if (device_timer.namedItem("timeStart").value != "" && device_timer.namedItem("timeOff").value != "" && device_timer.namedItem("timeOff").value <= device_timer.namedItem("timeStart").value) {
                device_timer.namedItem("timeOff").setCustomValidity("Giờ tắt không hợp lệ");
                device_timer.namedItem("timeOff").reportValidity();
                device_timer.namedItem("timeOff").setCustomValidity("");
                device_timer.namedItem("timeOff").value = "";
            }
        }
        function submit_timer(device_timer, device_room, deviceID) {
            if (device_timer.namedItem("dateStart").value != "" && device_timer.namedItem("timeStart").value != "") {
                var timeoff;
                if (device_timer.namedItem("timeOff").value == "")
                    timeoff = "00:00:00";
                else
                    timeoff = device_timer.namedItem("timeOff").value;

                var timer_list = {
                    "room": device_room,
                    "device": deviceID,
                    "date": device_timer.namedItem("dateStart").value,
                    "timeOn": device_timer.namedItem("timeStart").value,
                    "timeOff": timeoff
                };

                socket.emit("set_timer", timer_list);
                device_timer.namedItem("check").checked = true;
            }
        }
        function delete_timer(device_timer, device_room, deviceID) {
            if (device_timer.namedItem("dateStart").value != "" || device_timer.namedItem("timeStart").value != "" || device_timer.namedItem("timeOff").value != "") {
                var del = {
                    "Room": device_room,
                    "Device": deviceID,
                };

                socket.emit("delete_timer", del);

                device_timer.namedItem("dateStart").value = "";
                device_timer.namedItem("timeStart").value = "";
                device_timer.namedItem("timeOff").value = "";
                device_timer.namedItem("check").checked = false;
            }
        }

        //hiện thị thời gian đã hẹn lên timer table
        socket.on("timer-table", function (data) {
            device1_timer.namedItem("check").checked = false;
            device1_timer.namedItem("dateStart").value = "";
            device1_timer.namedItem("timeStart").value = "";
            device1_timer.namedItem("timeOff").value = "";
            device2_timer.namedItem("check").checked = false;
            device2_timer.namedItem("dateStart").value = "";
            device2_timer.namedItem("timeStart").value = "";
            device2_timer.namedItem("timeOff").value = "";
            device3_timer.namedItem("check").checked = false;
            device3_timer.namedItem("dateStart").value = "";
            device3_timer.namedItem("timeStart").value = "";
            device3_timer.namedItem("timeOff").value = "";
            device4_timer.namedItem("check").checked = false;
            device4_timer.namedItem("dateStart").value = "";
            device4_timer.namedItem("timeStart").value = "";
            device4_timer.namedItem("timeOff").value = "";
            for (let i in data) {
                if (data[i].Room == "livingroom") {
                    switch (data[i].Device) {
                        case 1:
                            device1_timer.namedItem("check").checked = true;
                            device1_timer.namedItem("dateStart").value = data[i].DateStart;
                            device1_timer.namedItem("timeStart").value = data[i].SetTimeOn;
                            if (data[i].SetTimeOff != "00:00:00")
                                device1_timer.namedItem("timeOff").value = data[i].SetTimeOff;
                            break;
                        case 2:
                            device2_timer.namedItem("check").checked = true;
                            device2_timer.namedItem("dateStart").value = data[i].DateStart;
                            device2_timer.namedItem("timeStart").value = data[i].SetTimeOn;
                            if (data[i].SetTimeOff != "00:00:00")
                                device2_timer.namedItem("timeOff").value = data[i].SetTimeOff;
                            break;
                        case 3:
                            device3_timer.namedItem("check").checked = true;
                            device3_timer.namedItem("dateStart").value = data[i].DateStart;
                            device3_timer.namedItem("timeStart").value = data[i].SetTimeOn;
                            if (data[i].SetTimeOff != "00:00:00")
                                device3_timer.namedItem("timeOff").value = data[i].SetTimeOff;
                            break;
                        case 4:
                            device4_timer.namedItem("check").checked = true;
                            device4_timer.namedItem("dateStart").value = data[i].DateStart;
                            device4_timer.namedItem("timeStart").value = data[i].SetTimeOn;
                            if (data[i].SetTimeOff != "00:00:00")
                                device4_timer.namedItem("timeOff").value = data[i].SetTimeOff;
                            break;
                        default: break;
                    }
                }
            }
        });
    </script>

    <!-- module xu ly thong bao va cai dat nguong -->
    <script>
        //toastr init
        toastr.options = {
            "closeButton": true,
            "debug": true,
            "newestOnTop": true,
            "progressBar": true,
            "positionClass": "toast-top-right",
            "preventDuplicates": true,
            "onclick": null,
            "showDuration": "300",
            "hideDuration": "5000",
            "timeOut": "5000",
            "extendedTimeOut": "1000",
            "showEasing": "swing",
            "hideEasing": "linear",
            "showMethod": "fadeIn",
            "hideMethod": "fadeOut"
        }
        //show lịch sử thông báo, dropdown notifi menu
        var history_temper_value = document.getElementById("temper_history");
        var history_temper_time = document.getElementById("temper_history_time");

        var history_humi_value = document.getElementById("humi_history");
        var history_humi_time = document.getElementById("humi_history_time");

        var history_co2_value = document.getElementById("co2_history");
        var history_co2_time = document.getElementById("co2_history_time");

        var history_gas_value = document.getElementById("gas_history");
        var history_gas_time = document.getElementById("gas_history_time");

        var history_dust_value = document.getElementById("dust_history");
        var history_dust_time = document.getElementById("dust_history_time");

        //cap nhat gia tri dropdown notifi menu
        document.getElementById("dropdownNotifiButton").addEventListener("click", function () {
            socket.emit("notifi_onclick", "trigger");
        });
        socket.on("update_notifi", function (data) {
            history_temper_value.innerHTML = data.Temper.value + '<span class="text-success text-sm font-weight-bolder ps-1">&degC</span>';
            history_temper_time.innerHTML = data.Temper.time;

            history_humi_value.innerHTML = data.Humi.value + '<span class="text-success text-sm font-weight-bolder ps-1">%</span>';
            history_humi_time.innerHTML = data.Humi.time;

            history_co2_value.innerHTML = data.Co2.value + '<span class="text-success text-sm font-weight-bolder ps-1">PPM</span>';
            history_co2_time.innerHTML = data.Co2.time;

            history_gas_value.innerHTML = data.Gas.value + '<span class="text-success text-sm font-weight-bolder ps-1">PPM</span>';
            history_gas_time.innerHTML = data.Gas.time;

            history_dust_value.innerHTML = data.Dust.value + '<span class="text-success text-sm font-weight-bolder ps-1">ug/m3</span>';
            history_dust_time.innerHTML = data.Dust.time;
        });

        //--------------xử lý giá trị đặt ngưỡng--------------------------------
        //onload sẽ cập nhật giá trị ngưỡng cũ từ database vào list dưới đây
        var setting_menu = document.getElementById("dropdownSettingMenu").elements;
        var setting_list = { "Temper": 0, "Humi": 0, "Co2": 0, "Gas": 0, "Dust": 0 };

        //cap nhat gia tri setting menu
        var setting_btn_dropdown = document.getElementById("dropdownSettingBtn");
        setting_btn_dropdown.addEventListener("click", function () {
            socket.emit("dropdownSettingMenu_onlick", "trigger");
        });

        socket.on("update_setting", function (data) {
            // console.log(data);
            setting_menu.namedItem("max-temper").value = data.Temper;
            setting_menu.namedItem("max-humi").value = data.Humi;
            setting_menu.namedItem("max-co2").value = data.Co2;
            setting_menu.namedItem("max-gas").value = data.Gas;
            setting_menu.namedItem("max-dust").value = data.Dust;
            setting_list.Temper = data.Temper;
            setting_list.Humi = data.Humi;
            setting_list.Co2 = data.Co2;
            setting_list.Gas = data.Gas;
            setting_list.Dust = data.Dust;
        });


        var submit_btn = document.getElementById("setting_btn");
        submit_btn.addEventListener("click", function () {
            if (setting_menu.namedItem("max-temper").value > 0)
                //nếu giá trị cài ngưỡng mới thỏa mãn đk thì update vào list
                setting_list.Temper = setting_menu.namedItem("max-temper").value;

            if (setting_menu.namedItem("max-humi").value > 0)
                setting_list.Humi = setting_menu.namedItem("max-humi").value;

            if (setting_menu.namedItem("max-co2").value > 0)
                setting_list.Co2 = setting_menu.namedItem("max-co2").value;

            if (setting_menu.namedItem("max-gas").value > 0)
                setting_list.Gas = setting_menu.namedItem("max-gas").value;

            if (setting_menu.namedItem("max-dust").value > 0)
                setting_list.Dust = setting_menu.namedItem("max-dust").value;

            socket.emit("change-setting", setting_list);
        });

        //hiển thị thông báo khi vượt ngưỡng cài đặt, mỗi lần server nhận đc dữ liệu mới từ cảm biến
        var notification = false;
        socket.on("notifi_mode", function (data) {
            console.log(data);
            if (data == "on")
                notification = true;
            else
                notification = false;
        });

        //dam bao sau khi mode variable da dc load
        $(document).ready(function () {
            socket.on("show_toastr", function (data) {
                if (notification) {
                    if (data.Temper >= setting_list.Temper)
                        toastr["success"](data.Temper + ' °C', "Nhiệt độ", { "iconClass": 'customer-temper' });

                    if (data.Humi >= setting_list.Humi)
                        toastr["success"](data.Humi + ' %', "Độ ẩm", { "iconClass": 'customer-humi' });

                    if (data.Co2 >= setting_list.Co2)
                        toastr["success"](data.Co2 + ' PPM', "Co2", { "iconClass": 'customer-co2' });

                    if (data.Gas >= setting_list.Gas)
                        toastr["success"](data.Gas + ' PPM', "Gas", { "iconClass": 'customer-gas' });

                    if (data.Dust >= setting_list.Dust)
                        toastr["success"](data.Dust + ' ug/m3', "Dust", { "iconClass": 'customer-dust' });
                }
            });
        });
    </script>

    <!-- camera display -->
    <script>
        var camera = document.getElementById("camera_input").elements;
        var camera_display = document.getElementById("showCamera");
        camera.namedItem("submitBtn").addEventListener("click", camera_url_validation);

        function camera_url_validation() {
            var url = camera.namedItem("urlCamera").value;
            if (url != "") {
                camera_display.setAttribute('src', "../image/loader.gif");
                setTimeout(function () {
                    var img = new Image();
                    img.src = url;
                    img.onload = function () {
                        camera_display.setAttribute('src', url);
                        socket.emit("save_camera_url", { "Room": "livingroom", "Url": url });
                    }
                    img.onerror = function () {
                        camera_display.setAttribute('src', "../image/no-signal.png");
                        // alert("invalid");
                    }
                }, 3000);
            }
        }

        socket.on("camera_url", function (data) {
            for (let i in data) {
                if (data[i].Room == "livingroom") {
                    camera_display.setAttribute('src', data[i].Url);
                    camera.namedItem("urlCamera").value = data[i].Url;
                }
            }
        })
    </script>